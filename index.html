<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>PHP DBA Cache by gjerokrsteski</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>PHP DBA Cache</h1>
          <h2>Create a caching with the Database (dbm-style) Abstraction Layer to cache your objects, strings, integers or arrays.</h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/gjerokrsteski/php-dba-cache/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/gjerokrsteski/php-dba-cache/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/gjerokrsteski/php-dba-cache" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
          <h1>Introduction</h1>

<p>The php-dba-cache uses the database (dbm-style) abstraction layer to cache/store your PHP objects, 
strings, integers or arrays. Even instances of SimpleXMLElement can be put to the cache. You dont 
have to matter about the size of the cache-file. It depends on the free space of your disk.</p>

<h1>Available options</h1>

<p>Cache</p>

<ul>
<li>Open a given dba database</li>
<li>Insert a new record with a given key (persistently or with a given expiration time)</li>
<li>Get a record with a given key</li>
<li>Replace the value of a record with a given key</li>
<li>Delete the record with a given key</li>
<li>Return metadata for the given key: expire timestamp &amp; timestamp of last modification time</li>
<li>Get all keys from cache</li>
</ul><p>Sweeper - CacheGarbageCollector (optional)</p>

<ul>
<li>Clean all entries</li>
<li>Clean expired entries</li>
<li>Flush the cache file</li>
<li>Optimizes the database file automatically after cleaning process</li>
</ul><h1>Installation</h1>

<p>"By using the --enable-dba=shared configuration option you can build a dynamic loadable module
to enable PHP for basic support of dbm-style databases. You also have to add support for at
least one of the following handlers by specifying the --with-XXXX configure switch
to your PHP configure line."</p>

<p>More about installation: <a href="http://www.php.net/manual/en/dba.installation.php">http://www.php.net/manual/en/dba.installation.php</a></p>

<h1>DBA handlers</h1>

<p>The behaviour of various aspects for the caching depends on the implementation of yor
installed dba-type database. I have tested it with several database-handlers like db4, flatfile,
cdb, cdb_make, gdbm. The cdb &amp; cdb_make family is the fastest, but you have to create
you own garbage-collection-cleaner or you can delete it manually. Take a look at the tests
(<a href="https://github.com/gjerokrsteski/php-dba-cache/tree/master/tests">https://github.com/gjerokrsteski/php-dba-cache/tree/master/tests</a>) to better understand
how to use the cache.</p>

<p>cdb = Tiny Constant Database - for reading
Cdb is "a fast, reliable, lightweight package for creating and reading constant databases.
" It is from the author of qmail and can be found at <a href="http://cr.yp.to/cdb.html">http://cr.yp.to/cdb.html</a>. Since it is
constant, we support only reading operations. And since PHP 4.3.0 we support writing
(not updating) through the internal cdb library.</p>

<p>cdb_make = Tiny Constant Database - for writing
Since PHP 4.3.0 we support creation of cdb files when the bundled cdb library is used.</p>

<p>db4 = Oracle Berkeley DB 4 - for reading and writing
DB4 is Sleepycat Software's DB4. This is available since PHP 4.3.2.</p>

<p>gdbm = GNU Database Manager - for reading and writing
Gdbm is the GNU database manager.</p>

<p>flatfile = default dba extension - for reading and writing
This is available since PHP 4.3.0 for compatibility with the deprecated dbm extension only
and should be avoided. However you may use this where files were created in this format.
That happens when configure could not find any external library.</p>

<p>More about requirements: <a href="http://www.php.net/manual/en/dba.requirements.php">http://www.php.net/manual/en/dba.requirements.php</a></p>

<h2>Nice to know</h2>

<p>Not all of the DBA-style databases can replace key-value pairs, like the CDB. The CDB database
can handle only with fixed key-value pairs. The best and fastest handlers for DBA-style caching
are: QDBM, Berkeley DB (DB4), NDBM and least the Flatfile.
Most problematic are dbm and ndbm which conflict with many installations. The reason for this is
that on several systems these libraries are part of more than one other library. The configuration
test only prevents you from configuring malfaunctioning single handlers but not combinations.</p>

<h2>Sample for Oracle Berkeley DB 4 with persistent connection</h2>

<div class="highlight"><pre><span class="nv">$cache</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Cache</span><span class="p">(</span>
  <span class="s1">'/your/path/to/the/cahe-file/cache.db4'</span><span class="p">,</span> <span class="s1">'db4'</span>
<span class="p">);</span>

<span class="nv">$yorObject</span>            <span class="o">=</span> <span class="k">new</span> <span class="nx">YourObjectYouWantToPutInCache</span><span class="p">();</span>
<span class="nv">$yourObjectIdentifier</span> <span class="o">=</span> <span class="s1">'md5(get_class($yorObject))'</span><span class="p">;</span>

<span class="c1">// Check if your object is in the cache.</span>
<span class="c1">// You also can ignore it, and let the CacheDba do it for you.</span>
<span class="k">if</span> <span class="p">(</span><span class="k">false</span> <span class="o">==</span> <span class="nv">$cache</span><span class="o">-&gt;</span><span class="na">has</span><span class="p">(</span><span class="nv">$yourObjectIdentifier</span><span class="p">))</span> <span class="p">{</span>
  <span class="nv">$cache</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">(</span><span class="nv">$yourObjectIdentifier</span><span class="p">);</span>
<span class="p">}</span>

<span class="nv">$cache</span><span class="o">-&gt;</span><span class="na">put</span><span class="p">(</span><span class="nv">$yourObjectIdentifier</span><span class="p">,</span> <span class="nv">$yorObject</span><span class="p">);</span>

<span class="c1">// Than somewhere at your project.</span>
<span class="nv">$cache</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="nv">$yourObjectIdentifier</span><span class="p">);</span>

<span class="c1">// For the garbage collection </span>
<span class="c1">// you can create an cron-job starting once a day.</span>
<span class="nv">$sweeper</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Sweeper</span><span class="p">(</span><span class="nv">$cache</span><span class="p">);</span>
<span class="nv">$sweeper</span><span class="o">-&gt;</span><span class="na">cleanAll</span><span class="p">();</span>

<span class="c1">// or clean all objects older than given expiration since now.</span>
<span class="nv">$sweeper</span><span class="o">-&gt;</span><span class="na">cleanOld</span><span class="p">();</span>
</pre></div>

<h2>Saving SimpleXMLElement instances into DB 4 with persistent connection</h2>

<div class="highlight"><pre><span class="nv">$string</span> <span class="o">=</span> <span class="s2">"&lt;?xml version='1.0'?&gt;</span>
<span class="s2">&lt;document&gt;</span>
<span class="s2"> &lt;title&gt;Let us cache&lt;/title&gt;</span>
<span class="s2"> &lt;from&gt;Joe&lt;/from&gt;</span>
<span class="s2"> &lt;to&gt;Jane&lt;/to&gt;</span>
<span class="s2"> &lt;body&gt;Some content here&lt;/body&gt;</span>
<span class="s2">&lt;/document&gt;"</span><span class="p">;</span>

<span class="nv">$simplexml</span> <span class="o">=</span> <span class="nb">simplexml_load_string</span><span class="p">(</span>
    <span class="nv">$string</span><span class="p">,</span>
    <span class="s1">'SimpleXMLElement'</span><span class="p">,</span>
    <span class="nx">LIBXML_NOERROR</span><span class="o">|</span><span class="nx">LIBXML_NOWARNING</span><span class="o">|</span><span class="nx">LIBXML_NONET</span>
<span class="p">);</span>

<span class="nv">$identifier</span> <span class="o">=</span> <span class="nb">md5</span><span class="p">(</span><span class="s1">'simplexml_identifier'</span><span class="p">);</span>

<span class="nv">$path</span> <span class="o">=</span> <span class="nb">dirname</span><span class="p">(</span><span class="k">__FILE__</span><span class="p">)</span><span class="o">.</span><span class="s1">'/simple-xml-test-cache.db4'</span><span class="p">;</span>
<span class="nv">$cache</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Cache</span><span class="p">(</span><span class="nv">$path</span><span class="p">,</span> <span class="s1">'db4'</span><span class="p">);</span>

<span class="nv">$cache</span><span class="o">-&gt;</span><span class="na">put</span><span class="p">(</span><span class="nv">$identifier</span><span class="p">,</span> <span class="nv">$simplexml</span><span class="p">);</span>

<span class="nv">$getObject</span> <span class="o">=</span> <span class="nv">$cache</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="nv">$identifier</span><span class="p">);</span>

<span class="nb">error_log</span><span class="p">(</span><span class="s1">' - PUT IN CACHE : '</span><span class="o">.</span><span class="nb">print_r</span><span class="p">(</span><span class="nv">$simplexml</span><span class="p">,</span> <span class="k">true</span><span class="p">));</span>
<span class="nb">error_log</span><span class="p">(</span><span class="s1">' - GET FROM CACHE : '</span><span class="o">.</span><span class="nb">print_r</span><span class="p">(</span><span class="nv">$getObject</span><span class="p">,</span> <span class="k">true</span><span class="p">));</span>

<span class="nb">error_log</span><span class="p">(</span><span class="s1">' - IS SAME OBJECT : '</span><span class="o">.</span>
    <span class="nb">print_r</span><span class="p">((</span><span class="nv">$simplexml</span><span class="o">-&gt;</span><span class="na">asXml</span><span class="p">()</span> <span class="o">===</span> <span class="nv">$getObject</span><span class="o">-&gt;</span><span class="na">asXml</span><span class="p">())</span>
            <span class="o">?</span> <span class="s1">'true'</span> <span class="o">:</span> <span class="s1">'false'</span><span class="p">,</span> <span class="k">true</span><span class="p">));</span>
</pre></div>

<h2>PHP DBA Cache Monitor</h2>

<p>PHP DBA Cache Monitor is an adaptive web-interface to provide a comprehensive, easy to use 
and of course good looking GUI. It not only gives access to statistical parameters of DBA Cache, 
it also makes it easier to administer web-servers running DBA by providing comfortable features 
for optimizing the cache and deleting entries from the cache. </p>

<p><img src="http://farm9.staticflickr.com/8528/8547311457_9e4a7ca45d.jpg" alt="PHP DBA cache Monitor 2013" title="PHP DBA Cache Monitor"></p>

<h2>Benchmark Test of DBM Brothers</h2>

<p>This benchmark test is to calculate processing time (real time)
and file size of database. Writing test is to store 1,000,000 records. Reading test is
to fetch all of its records. Both of the key and the value of each record are such 8-byte
strings as <code>00000001',</code>00000002', `00000003'... Tuning parameters of each DBM are set to
display its best performance. Platform: Linux 2.4.31 kernel, EXT2 file system,
Pentium4 1.7GHz CPU, 1024MB RAM, ThinkPad T42 Compilation: gcc 3.3.2 (using -O3), glibc 2.3.3</p>

<p>Result</p>

<pre lang="cli"><code>NAME        DESCRIPTION                             WRITE TIME  READ TIME   FILE SIZE
QDBM        Quick Database Manager 1.8.74           1.89        1.58        55257
NDBM        New Database Manager 5.1                8.07        7.79        814457
SDBM        Substitute Database Manager 1.0.2       11.32       0.00        606720
GDBM        GNU Database Manager 1.8.3              14.01       5.36        82788
TDB         Trivial Database 1.0.6                  9.64        2.22        51056
CDB         Tiny Constant Database 0.75             0.87        0.80        39065
BDB         Berkeley DB 4.4.20                      9.62        5.62        40956
QDBM-BT-ASC B+ tree API of QDBM (ascending order)   2.37        1.78        24304
QDBM-BT-RND B+ tree API of QDBM (at random)         10.90       4.82        15362
BDB-BT-ASC B+ tree API of BDB (ascending order)     3.04        3.06        27520
BDB-BT-RND B+ tree API of BDB (at random)           10.03       4.15        29120
</code></pre>

<p>Unit of time is seconds. Unit of size is kilo bytes. Read time of SDBM can not be calculated
because its database is broken when more than 100000 records.</p>
        </section>

        <footer>
          PHP DBA Cache is maintained by <a href="https://github.com/gjerokrsteski">gjerokrsteski</a><br>
          This page was generated by <a href="http://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="http://twitter.com/jasonlong">Jason Long</a>.
        </footer>

        
      </div>
    </div>
  </body>
</html>